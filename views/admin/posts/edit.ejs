<%- include('../../partials/header') %>

    <div class="admin-form-container">
        <h1>
            <%= title %>
        </h1>

        <% if (locals.error) { %>
            <div class="error">
                <%= error %>
            </div>
            <% } %>

                <form action="<%= post ? '/admin/posts/edit/' + post.id : '/admin/posts/new' %>" method="POST">
                    <div class="form-group">
                        <label>Title</label>
                        <input type="text" name="title" value="<%= post ? post.title : '' %>" required>
                    </div>

                    <!-- Featured Image: For the preview card/hero mainly -->
                    <div class="form-group">
                        <label>Featured Image (Base64) - For Card Preview</label>
                        <input type="file" id="imageInput" accept="image/*">
                        <input type="hidden" name="image_base64" id="imageBase64"
                            value="<%= post ? post.image_base64 : '' %>">
                        <div id="imagePreview">
                            <% if (post && post.image_base64) { %>
                                <img src="<%= post.image_base64 %>" style="max-width: 200px; margin-top: 10px;">
                                <% } %>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Excerpt</label>
                        <textarea name="excerpt" rows="3"><%= post ? post.excerpt : '' %></textarea>
                    </div>

                    <div class="form-group">
                        <label>Content</label>
                        <textarea id="summernote" name="content" required><%= post ? post.content : '' %></textarea>
                    </div>

                    <!-- Removed separate Video URL field as user assumes dynamic embedding -->
                    <input type="hidden" name="video_url" value="<%= post ? post.video_url : '' %>">

                    <div class="form-group">
                        <label>Status</label>
                        <select name="status">
                            <option value="draft" <%=post && post.status==='draft' ? 'selected' : '' %>>Draft</option>
                            <option value="published" <%=post && post.status==='published' ? 'selected' : '' %>
                                >Published</option>
                        </select>
                    </div>

                    <button type="submit" class="btn">Save Post</button>
                    <a href="/admin/dashboard" class="btn btn-secondary">Cancel</a>
                </form>
    </div>

    <script>
        $('#summernote').summernote({
            placeholder: 'Write your content here... Insert images or videos directly.',
            tabsize: 2,
            height: 400,
            toolbar: [
                ['style', ['style']],
                ['font', ['bold', 'underline', 'clear']],
                ['color', ['color']],
                ['para', ['ul', 'ol', 'paragraph']],
                ['table', ['table']],
                ['insert', ['link', 'picture', 'video']],
                ['view', ['fullscreen', 'codeview', 'help']]
            ]
        });

        document.getElementById('imageInput').addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (evt) {
                    document.getElementById('imageBase64').value = evt.target.result;
                    document.getElementById('imagePreview').innerHTML = '<img src="' + evt.target.result + '" style="max-width: 200px; margin-top: 10px;">';
                };
                reader.readAsDataURL(file);
            }
        });
    </script>

    <%- include('../../partials/footer') %>